{% extends "base.html" %}

{% block title %}Send Captain Invite - {{ team.country_flag }} {{ team.country_name }}{% endblock %}

{% block content %}
<div class="container">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('pcl.admin_dashboard') }}">PCL Admin</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('pcl.admin_tournament_detail', tournament_id=team.tournament_id) }}">{{ team.tournament.name }}</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('pcl.admin_team_detail', team_id=team.id) }}">{{ team.country_name }} {{ team.age_category }}</a></li>
            <li class="breadcrumb-item active">Send Captain Invite</li>
        </ol>
    </nav>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <h1 class="mb-4">
                <i class="bi bi-whatsapp"></i> Send Captain Invitation
            </h1>
            
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">{{ team.country_flag }} {{ team.country_name }} {{ team.age_category }}</h5>
                </div>
                <div class="card-body">
                    <p><strong>Tournament:</strong> {{ team.tournament.name }}</p>
                    <p><strong>Deadline:</strong> {{ team.tournament.registration_deadline.strftime('%d.%m.%Y %H:%M') }}</p>
                    
                    {% if captain_reg %}
                    <div class="alert alert-success">
                        <i class="bi bi-check-circle"></i> <strong>Captain found:</strong> 
                        {{ captain_reg.first_name }} {{ captain_reg.last_name }}
                        {% if captain_reg.phone %}
                        ({{ captain_reg.phone }})
                        {% else %}
                        <span class="text-warning">- No phone number!</span>
                        {% endif %}
                    </div>
                    {% else %}
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle"></i> <strong>No captain registered yet!</strong>
                        Enter the captain details manually below.
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-send"></i> Captain Details</h5>
                </div>
                <div class="card-body">
                    <form method="POST">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="captain_name" class="form-label">Captain Name *</label>
                                <input type="text" class="form-control" id="captain_name" name="captain_name" 
                                       value="{% if captain_reg %}{{ captain_reg.first_name }} {{ captain_reg.last_name }}{% endif %}"
                                       placeholder="Max Mustermann" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="captain_phone" class="form-label">WhatsApp Number *</label>
                                <input type="tel" class="form-control" id="captain_phone" name="captain_phone" 
                                       value="{% if captain_reg and captain_reg.phone %}{{ captain_reg.phone }}{% endif %}"
                                       placeholder="+49123456789" required>
                                <small class="form-text text-muted">With country code (e.g., +49, +34)</small>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="language" class="form-label">Message Language *</label>
                            <select class="form-select" id="language" name="language">
                                <option value="EN" {% if captain_reg and captain_reg.preferred_language == 'EN' %}selected{% endif %}>ğŸ‡¬ğŸ‡§ English</option>
                                <option value="DE" {% if captain_reg and captain_reg.preferred_language == 'DE' %}selected{% endif %}>ğŸ‡©ğŸ‡ª Deutsch</option>
                                <option value="ES" {% if captain_reg and captain_reg.preferred_language == 'ES' %}selected{% endif %}>ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                                <option value="FR" {% if captain_reg and captain_reg.preferred_language == 'FR' %}selected{% endif %}>ğŸ‡«ğŸ‡· FranÃ§ais</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="test_mode" name="test_mode">
                                <label class="form-check-label" for="test_mode">
                                    <strong>Test Mode</strong> (only show in console, don't actually send)
                                </label>
                            </div>
                        </div>

                        <hr>

                        <!-- Preview -->
                        <div class="mb-4">
                            <h6><i class="bi bi-eye"></i> Message Preview</h6>
                            <div class="border rounded p-3 bg-light" style="white-space: pre-line; font-size: 0.9rem;">
ğŸ† PCL {{ team.tournament.name }} - Team Captain Invitation

Hi [Captain Name]! ğŸ‘‹

You have been selected as Captain for {{ team.country_flag }} {{ team.country_name }} {{ team.age_category }}!

ğŸ“‹ Your responsibilities:
â€¢ Register your team players
â€¢ Ensure all profiles are complete
â€¢ Coordinate with your team

ğŸ”— Your secret Captain Dashboard:
[Captain URL]

âš ï¸ Keep this link private - only you should have access!

ğŸ“… Deadline: {{ team.tournament.registration_deadline.strftime('%d.%m.%Y %H:%M') }}

Let's go! ğŸ¾
WPC Series Europe
                            </div>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{{ url_for('pcl.admin_team_detail', team_id=team.id) }}" class="btn btn-secondary">
                                <i class="bi bi-x-circle"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="bi bi-whatsapp"></i> Send Captain Invitation
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Captain Dashboard Link Info -->
            <div class="card mt-4">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0"><i class="bi bi-link-45deg"></i> Captain Dashboard Link</h6>
                </div>
                <div class="card-body">
                    <p class="mb-2">This link will be sent to the captain:</p>
                    <div class="input-group">
                        <input type="text" class="form-control" id="captainUrl" 
                               value="{{ request.host_url }}pcl/team/{{ team.captain_token }}" readonly>
                        <button class="btn btn-outline-secondary" type="button" onclick="copyUrl()">
                            <i class="bi bi-clipboard"></i> Copy
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function copyUrl() {
    const input = document.getElementById('captainUrl');
    input.select();
    document.execCommand('copy');
    
    const btn = event.target.closest('button');
    const originalHTML = btn.innerHTML;
    btn.innerHTML = '<i class="bi bi-check"></i> Copied!';
    btn.classList.remove('btn-outline-secondary');
    btn.classList.add('btn-success');
    
    setTimeout(() => {
        btn.innerHTML = originalHTML;
        btn.classList.remove('btn-success');
        btn.classList.add('btn-outline-secondary');
    }, 2000);
}
</script>
{% endblock %}