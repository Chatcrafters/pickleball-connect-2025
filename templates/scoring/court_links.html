{% extends "base.html" %}
{% block title %}Court Manager Links - {{ tournament.name }}{% endblock %}
{% block extra_head %}
<style>
    .link-card { border: 2px dashed #dee2e6; border-radius: 10px; padding: 1.25rem; margin-bottom: 1rem; text-align: center; break-inside: avoid; }
    .link-card h3 { margin-bottom: 0.5rem; }
    .link-url { font-family: monospace; font-size: 0.85rem; word-break: break-all; background: #f8f9fa; padding: 0.5rem; border-radius: 5px; margin: 0.5rem 0; }
    .manager-name { color: #6c757d; font-size: 0.9rem; }
    @media print { .navbar, footer, .no-print { display: none !important; } .link-card { border: 2px solid #000; page-break-inside: avoid; } }
</style>
{% endblock %}
{% block content %}
<div class="container">
    <nav aria-label="breadcrumb" class="no-print"><ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('scoring.setup_tournament', tournament_id=tournament.id) }}">Scoring Setup</a></li>
        <li class="breadcrumb-item active">Court Manager Links</li>
    </ol></nav>
    <div class="d-flex justify-content-between align-items-center mb-4 no-print">
        <h1><i class="bi bi-qr-code"></i> Court Manager Links</h1>
        <div class="d-flex gap-2">
            <button onclick="window.print()" class="btn btn-outline-primary"><i class="bi bi-printer"></i> Drucken</button>
            <a href="{{ url_for('scoring.live_dashboard', tournament_id=tournament.id) }}" class="btn btn-danger"><i class="bi bi-activity"></i> Live Dashboard</a>
        </div>
    </div>
    <div class="alert alert-info no-print"><i class="bi bi-info-circle"></i> Jeder Court Manager erhaelt seinen eigenen Link. Kein Login noetig - einfach den Link oeffnen und Scores eintragen.</div>
    <div class="row">
        {% for court in courts %}
        <div class="col-md-6 col-lg-4">
            <div class="link-card">
                <h3><i class="bi bi-geo-alt"></i> Court {{ court.court_number }}</h3>
                {% if court.manager_name %}<div class="manager-name">{{ court.manager_name }}</div>{% endif %}
                <div class="link-url">{{ court.get_manager_url() }}</div>
                <div class="d-flex gap-2 justify-content-center no-print">
                    <button class="btn btn-sm btn-outline-primary" onclick="copyLink('{{ court.get_manager_url() }}', this)"><i class="bi bi-clipboard"></i> Kopieren</button>
                    <a href="{{ url_for('scoring.court_manager', token=court.manager_token) }}" class="btn btn-sm btn-outline-success" target="_blank"><i class="bi bi-box-arrow-up-right"></i> Oeffnen</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% if not courts %}
    <div class="text-center text-muted py-5">
        <i class="bi bi-geo-alt" style="font-size: 3rem;"></i>
        <p class="mt-2">Noch keine Courts angelegt.</p>
        <a href="{{ url_for('scoring.setup_tournament', tournament_id=tournament.id) }}" class="btn btn-primary"><i class="bi bi-plus-circle"></i> Courts erstellen</a>
    </div>
    {% endif %}
</div>
{% endblock %}
{% block extra_scripts %}
<script>
function copyLink(url, btn) {
    navigator.clipboard.writeText(url).then(() => {
        const orig = btn.innerHTML;
        btn.innerHTML = '<i class="bi bi-check"></i> Kopiert!';
        btn.classList.replace('btn-outline-primary', 'btn-success');
        setTimeout(() => { btn.innerHTML = orig; btn.classList.replace('btn-success', 'btn-outline-primary'); }, 2000);
    });
}
</script>
{% endblock %}
